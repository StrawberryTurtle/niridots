# Cannot be run as root
if [ "$(id -u)" = 0 ]; then
    echo "Cannot be run as root."
    exit 1
fi

# Define packages
dependencias=(  noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra otf-font-awesome \
                blueman network-manager-applet \
		fuzzel mako waybar kitty swaybg swayidle swaylock xwayland-satellite ly lxsession-gtk3 xdg-desktop-portal-gnome \
                nwg-look qt6-wayland glfw-wayland qt6ct \
                pavucontrol git lsd zsh neovim htop hyfetch firefox discord fcitx5-mozc \
                yazi ffmpegthumbnailer p7zip jq poppler fd ripgrep fzf imagemagick viewnior \
		niri )

is_installed() {
  pacman -Qi "$1" &> /dev/null
  return $?
}

for paquete in "${dependencias[@]}"
do
  if ! is_installed "$paquete"; then
    sudo pacman -S "$paquete" --noconfirm
    printf "\n"
  else
    sleep 1
  fi
done
sleep 3
clear


# Install Yay
if ! command -v yay >/dev/null 2>&1; then
	printf "%s%sInstalling yay%s\n"
	cd
	git clone https://aur.archlinux.org/yay.git
	cd yay
	makepkg -si --noconfirm
	cd
else
	printf "%s%sYay is already installed%s\n"
fi

# Random Packages
yay -S lorien-bin --noconfirm
yay -S tokyonight-gtk-theme-git --noconfirm
yay -S tlpui --noconfirm

# Preparing Folders
if [ ! -e ~/.config/user-dirs.dirs ]; then
	xdg-user-dirs-update
	echo "Creating xdg-user-dirs"
else
	echo "user-dirs.dirs already exists"
fi
sleep 2 
clear

# Cloning Rice
cd
git clone --depth=1 https://github.com/StrawberryTurtle/niridots.git
sleep 2
clear

# Prepare Directory
mkdir -p ~/.config/systemd/user/niri.service.wants

# Copy Rice
for archivos in ~/niridots/config/*; do
  cp -R "${archivos}" ~/.config/
  if [ $? -eq 0 ]; then
	printf "%s%s%s folder copied succesfully!%s\n"
	sleep 1
  else
	printf "%s%s%s failed to copy config%s\n"
	sleep 1
  fi
done

cp -f ~/niridots/.zshrc ~

fc-cache -rv >/dev/null 2>&1
printf "%s%sFiles copied succesfully!!%s\n"
sleep 3

systemctl enable NetworkManager bluetooth ly

dconf write /org/gnome/desktop/interface/color-scheme '"prefer-dark"'

sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
